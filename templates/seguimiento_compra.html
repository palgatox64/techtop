{% extends 'base.html' %}
{% load static %}

{% block title %}Seguimiento de Compra - Techtop{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/tracking.css' %}">

<div class="tracking-page">
    <div class="tracking-input-section">
        <h1>Seguimiento de tu Compra</h1>
        <p>Ingresa el número de tu pedido para ver su estado actual.</p>
        <form class="tracking-form" method="GET">
            <input type="text" name="orden_id" placeholder="Ej: 34" value="{{ orden_buscada }}" required>
            <button type="submit">Rastrear Pedido</button>
        </form>
        {% if error %}
            <p style="color: #dc3545; margin-top: 15px;">{{ error }}</p>
        {% endif %}
    </div>

    {% if pedido %}
    <div class="tracking-results-section">
        <h2>Estado del Pedido #{{ pedido.id }}</h2>

        {% with estado=pedido.estado %}
        <div class="progress-timeline status-{{ estado }}">
            <div class="step complete">
                <div class="step-icon"><i class='bx bxs-package'></i></div>
                <div class="step-label">Realizado</div>
                <div class="step-date">{{ pedido.fecha_pedido|date:"d M, Y" }}</div>
            </div>
            
            <div class="step {% if estado == 'procesando' or estado == 'enviado' or estado == 'entregado' %}complete{% endif %} {% if estado == 'pendiente' %}active{% endif %}">
                <div class="step-icon"><i class='bx bxs-receipt'></i></div>
                <div class="step-label">Procesando</div>
            </div>
            
            <div class="step {% if estado == 'enviado' or estado == 'entregado' %}complete{% endif %} {% if estado == 'procesando' %}active{% endif %}">
                <div class="step-icon"><i class='bx bxs-truck'></i></div>
                <div class="step-label">Enviado</div>
            </div>
            
            <div class="step {% if estado == 'entregado' %}complete{% endif %} {% if estado == 'enviado' %}active{% endif %}">
                <div class="step-icon"><i class='bx bxs-home'></i></div>
                <div class="step-label">Entregado</div>
            </div>
        </div>
        {% endwith %}
        
        <div class="tracking-details">
            <h3>Detalles Actuales</h3>
            {% if pedido.estado == 'pendiente' %}
                <p>Tu pedido ha sido recibido y está pendiente de pago o confirmación.</p>
            {% elif pedido.estado == 'procesando' %}
                <p>Estamos preparando tu pedido para ser despachado.</p>
            {% elif pedido.estado == 'enviado' %}
                <p>¡Tu pedido va en camino! {% if pedido.direccion_envio %}Va hacia {{ pedido.direccion_envio.ciudad }}{% else %}Está listo para retiro en tienda{% endif %}.</p>
            {% elif pedido.estado == 'entregado' %}
                <p>El pedido ha sido entregado exitosamente. ¡Gracias por tu compra!</p>
            {% elif pedido.estado == 'cancelado' %}
                 <p style="color: #dc3545;">Este pedido ha sido cancelado.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}